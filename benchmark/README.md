# CDN vs Local 完整对比

这个目录包含用于对比本地打包文件与 CDN 版本的完整工具。

## 📦 功能说明

### 完整对比脚本 (`compare.js`)

一键对比本地版本和 CDN 版本的：

1. **📦 文件体积** - 对比打包文件大小差异
2. **📊 准确率** - 使用标准测试文本验证拼音转换准确性
3. **⚡ 速度** - 运行 100 次取平均值，对比性能差异

## 🚀 使用方法

### 本地运行

```bash
# 运行完整对比（需要先手动打包）
npm run compare

# 打包后自动运行对比
npm run build:compare
```

### 自动化运行

GitHub Actions 会在以下情况自动运行完整对比：

#### Pull Request 触发
当向 `main` 分支创建或更新 PR 时，会自动触发对比：
- **PR 创建时** (`opened`)
- **PR 更新时** (`synchronize`) - 推送新提交
- **PR 重新打开时** (`reopened`)

对比结果会自动作为评论发布到 PR 中，并在每次推送新提交时自动更新该评论。

#### Push 触发
当代码直接推送到 `main` 分支时，对比结果会显示在 GitHub Actions 的运行日志中。

#### 工作流程

```
创建/更新 PR to main
       ↓
触发 GitHub Actions
       ↓
安装依赖 (npm install)
       ↓
构建项目 (npm run build)
       ↓
运行完整对比 (npm run compare)
       ↓
  ┌─────────────────────┐
  │  📦 文件体积对比    │
  │  📊 准确率测试      │
  │  ⚡ 速度测试        │
  └─────────────────────┘
       ↓
  ┌─────────────────┐
  │ PR 中自动发布/  │
  │ 更新评论        │
  └─────────────────┘
```

## 📊 输出示例

### 本地运行输出

```
========================================
   CDN vs Local 完整对比
========================================

📦 文件体积对比
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

正在读取本地文件...
本地文件大小: 315.20 KB
正在获取 CDN 文件大小...
CDN 文件大小:  315.20 KB

✅ 本地文件与 CDN 文件大小相同

⚖️ 功能对比 (准确率 & 速度)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

正在加载本地版本...
✓ 本地版本加载成功
正在下载 CDN 版本...
✓ CDN 版本下载并加载成功

📊 准确率测试
本地版本: 100.00% (错误: 0/172)
CDN 版本:  100.00% (错误: 0/172)
✅ 准确率相同

⚡ 速度测试 (100次运行平均值)
本地版本: 0.13ms /次
CDN 版本:  0.11ms /次
⚠️ CDN 版本更快 18.18%

========================================
```

### PR 评论示例

当在 PR 中触发时，会自动创建如下评论：

```
## 📦 CDN vs Local 完整对比

========================================
   CDN vs Local 完整对比
========================================

📦 文件体积对比
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

正在读取本地文件...
本地文件大小: 315.20 KB
正在获取 CDN 文件大小...
CDN 文件大小:  315.20 KB

✅ 本地文件与 CDN 文件大小相同

⚖️ 功能对比 (准确率 & 速度)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

正在加载本地版本...
✓ 本地版本加载成功
正在下载 CDN 版本...
✓ CDN 版本下载并加载成功

📊 准确率测试
本地版本: 100.00% (错误: 0/172)
CDN 版本:  100.00% (错误: 0/172)
✅ 准确率相同

⚡ 速度测试 (100次运行平均值)
本地版本: 0.13ms /次
CDN 版本:  0.11ms /次
⚠️ CDN 版本更快 18.18%

========================================

Updated at Fri, 17 Jan 2026 02:30:15 GMT

---
💡 提示: 此评论会在每次推送新提交时自动更新
```

## 🔧 技术细节

- 自动检测 CI 环境，调整输出格式
- 支持 HTTPS 重定向处理
- 彩色终端输出（仅本地环境）
- GitHub Actions 注释集成
- 自动更新 PR 评论（避免重复评论）
- 一次运行完成三项对比（体积、准确率、速度）

## 📝 相关文件

- `compare.js` - 完整对比脚本（整合了体积、准确率、速度对比）
- `../.github/workflows/ci.yaml` - 主 CI 工作流
- `../.github/workflows/size-compare.yaml` - 独立的对比工作流
